---
layout:     post                    # 使用的布局（不需要改）
title:      csrf和ssrf               # 标题 
subtitle:   回顾整理一下之前的学习笔记
date:       2020-03-30              # 时间
author:     z0L1n                      # 作者
header-img: img/post-bg-2015.jpg    #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               #标签
    - web漏洞
---

## 0x00csrf
> cross-site request forgery   跨站请求伪造亦称为 one click attack和session riding:通过伪装成受信用的用户请求受信任的网站，比较难以防范，一般与xss联合达到攻击目的
XSS利用站点内的信任用户，而CSRF则通过伪装来自受信任用户的请求来攻击受信任的网站。与XSS攻击相比，CSRF攻击往往不大流行（因此对其进行防范的资源也相当稀少）和难以防范，所以被认为比XSS更具危险性。

- 我们可以这么理解CSRF攻击：攻击者首先盗用了你的身份，然后以你的名义进行某些非法操作。CSRF能够使用你的账户发送邮件，获取你的敏感信息，甚至盗走你的账户购买商品等。CSRF攻击其实是利用了web中用户身份认证验证的一个漏洞：简单的身份验证仅仅能保证请求发自某个用户的浏览器，却不能保证请求本身是用户自愿发出的。
**一个典型的CSRF攻击有以下流程：**
- 受害者登录a.com，并且保留了登录凭证。
- 攻击者引诱受害者访问了b.com。
- b.com向a.com发送了一个请求。受害者浏览器默认携带a.com的用户凭证。
- a.com接收到请求后，对请求进行验证，并且确认是受害者的用户凭证，误认为是受害者发出的请求。
- a.com执行了请求
- 攻击完成，攻击者在受害者不知情的情况下，冒充受害者执行了攻击操作。

**攻击类型：**
- 1、GET类型：大多数为资源包含，控制html标签（例如<image>/<audio>/<video>/<object>/<script>/<iframe>等含有src属性的标签），能够发起一次get请求。
    一旦访问带有类似攻击代码的网页，即可通过发起get请求进行攻击。
- 2、post类型：在b.com里面构造好有个form表单，然后利用js自动提交这个表单
```
<script>
    new Image().src="http://xxxxxxxx/xxxx/xxx"
</script>
或者
<form action=http://woyun.org/csrf.php method=POST>
<input type="text" name='xx' value='11' />
</form>
<script>document.forms[0].submit();</script>
```
- 倘若攻击时涉及到cookie，我们需要知道cookie分为session cookie和third-party cookie，一个为临时，一个为本地。拦截本地cookie的浏览器为IE,safari。

对于csrf攻击的防御：
- 验证http referer字段，该字段记录了http请求的来源地址。在正常情况下，referer的值是由浏览器提供的，这类方法依赖第三方（浏览器），一般来说不会有太大的问题。
- 添加token验证：这种方法主要旨在在请求中放入攻击者所不能伪造的信息，并且该信息不在cookie中，在每个请求上都加上，可以有效避免csrf攻击，但是由于程序员的疏忽可能导致边缘业务请求上遗漏，
- 添加验证码：在特殊重要功能上添加验证码能有效减少csrf攻击的利用。


## 0x01ssrf
>server-site request forgery由攻击者构造请求，由服务端发起请求的安全漏洞，一般情况下，ssrf攻击的目标是外网无法访问的内部系统，简单来说经由操作服务端从指定url地址获取内容以及利用web应用作为代理攻击远程和本地的服务器.

- 可以这样简单解释一下，很多web应用都提供了从其他的服务器上获取数据的功能。使用指定的URL，web应用便可以获取图片，下载文件，读取文件内容等。SSRF的实质是利用存在缺陷的web应用作为代理攻击远程和本地的服务器。一般情况下， SSRF攻击的目标是外网无法访问的内部系统，黑客可以利用SSRF漏洞获取内部系统的一些信息（正是因为它是由服务端发起的，所以它能够请求到与它相连而与外网隔离的内部系统）。SSRF形成的原因大都是由于服务端提供了从其他服务器应用获取数据的功能且没有对目标地址做过滤与限制。

**对于ssrf实现的攻击有以下：**
- 1、可以对外网、服务器内网、本地进行端口扫描，获取banner信息
- 2、对内网web应用进行指纹识别、对内网或本地应用程序进行攻击
- 3、利用file协议读取本地文件
- 4、访问敏感信息
- 5、攻击内外网的web应用

**基本防御措施：**
- 设置黑名单，白名单
- 禁用不需要的协议
- 过滤返回信息
- 统一错误信息

