---
layout:     post                    # 使用的布局（不需要改）
title:      nmap的使用               # 标题 
subtitle:   回顾整理一下之前的学习笔记
date:       2020-03-29              # 时间
author:     z0L1n                      # 作者
header-img: img/post-bg-2015.jpg    #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               #标签
    - web漏洞
---


## 0x00nmap简介：
> nmap，是网络扫描和嗅探工具包，用来扫描网上电脑开放的网络连接端，确定哪些服务运行在哪些端口。其基本功能如下
>- 主机发现：nmap提供了多种检测机制，用于发现目标主机是否处于活动状态
>- 扫描主机端口，嗅探所提供的网络服务：nmap可以将端口识别为open/close/filtered/unfiltered/open|filtered/close|filtered，默认情况下会扫描常用端口
>- 版本侦测：用于识别端口上运行的应用程序与程序版本
>- 操作系统侦测：用于识别目标机的操作系统类型、版本编号以及设备类型。
>- 此外，nmap提供多种机制来规避防火墙、IDS的屏蔽和检查，便于秘密地探查目标机的状况。基本规避方式有：分片、IP诱骗、IP伪装、mac地址伪装等等。以及
nmap有自己的脚本库，能用来拓展高级的功能如web扫描，漏洞发现等，一般用于增强主机发现、端口扫描、版本侦测等

## 0x01：主机发现：
- -sL(列表扫描）：仅仅列出指定网络上的每台主机，不发送任何报文到目标主机。默认情况下，nmap会对主机进行反向域名解析以获取他的名字，该模式是主机发现的
退化形式。
- -sP（ping扫描）：仅仅进行ping扫描，然后打印出对扫描做出响应的那些主机。默认情况下发送一个ICMP回声请求和一个TCP报文到80端口，可以和除-P0外的选项
结合一起使用
- -P0（无ping）：该选项完全跳过nmap发现阶段，对每一个指定的目标IP地址进行所要求的的扫描，具体结合其他选项来进行。
- -PS（tcp syn ping）：默认目的端口为80，发送设置了syn标志位的空tcp报文，如果有回应则表示该主机正在运行，无论是rst、syn/ack。还可以进行不同的端口
的指定：`-PS22,23,80,1050`，这样就会使每个指定端口并发地被扫描。
- -PA（tcp ack ping）：该选项和-PS类似，区别就是设置tcp的ack标志位，ack报文表示确认一个建立连接的尝试，对于防火墙来说容易被识别成伪造的而丢弃，但是对于无状态防火墙来说却是一个闪光点，所以
一般和-PS连用来进行最大限度的探测。
- -PU（UDP PING）:发送空的UDP报文到指定的端口，一般情况下默认是31338这个极为不可能被使用的端口，如果目标机的端口是关闭的，则会得到一个ICMP端口无法
到达的回应报文，这样就暴露了主机是存活的。而对于开放的端口，则大部分服务会忽略这个空报文而不做出任何回应，这样也能暴露存活主机。可以和`-PS`一样指定端口。
- -PR(arp ping)：arp扫描比基于ip的扫描更快更可靠，默认情况下，如果发现目标主机在它所在的局域网上，它会进行arp扫描。
- -PE; -PP; -PM（ICMP PING TYPES）:这几个都是发送的icmp报文的类型，分别是回声响应，时间戳和地址掩码查询，一般来说结合起来可以在管理员忽略了这些
不同类型的ICMP查询时，更容易的发现主机。
- -n(不用域名解析）
- -R（为所有目标解析域名）

![](https://github.com/z0L1n/pic/blob/master/2002/nmap/68747470733a2f2f7778312e73696e61696d672e636e2f6d773639302f303037494d5462716c7931676462316434337864346a33306a783064776165702e6a7067.jpg?raw=true)

## 0x02：常用扫描技巧：
- -sS（tcp syn scan）：半开放扫描，效率高不会产生任何会话，目标主机几乎不会把连接计入系统日志，效率高。

![](https://github.com/z0L1n/pic/blob/master/2002/nmap/2.jpg?raw=true)

- -sT（tcp connect scam）：默认扫描模式，需要完成三次握手，效率低，速度慢，这种扫描很容易被检测到，目标主机会有大量日志记录。
- -sU（udp scan）：扫描速度比较慢，和-PU差不多。
- -sF（fin scan）：因为有防火墙的存在，目标主机有可能有IDS和IPS系统，syn数据包和icmp包可能会被阻止，所以发送设置了fin标志位的数据包来检测，和sS效果
差不多，比sT速度快。
- -sA（ack扫描）：用于确定防火墙规则，是否有状态，以及端口是否被过滤
- -sV（版本扫描）：扫描目标主机和端口上运行的软件版本，不侧重于端口的发现。

![](https://github.com/z0L1n/pic/blob/master/2002/nmap/3.jpg?raw=true)
- -sW(tcp 窗口扫描）和ack扫描差不多

## 0x03：其他选项：
- -p 指定端口
- -F 快速扫描
- -O 操作系统检测 
- --osscan-guess 推测操作系统检测结果
- sC 根据端口识别的服务，调用默认脚本，如果要使用特定脚本可以查手册进行使用，但是一般很少用。
- -v 详细输出探测信息
- -A os识别，版本探测，脚本扫描和traceroute
- -iL 从文件中读取待检测的目标，支持ip，网段，机名
- -traceroute 路由跟踪
- -T[0-5] 级别越高，扫描越快！！！一般T4

![](https://github.com/z0L1n/pic/blob/master/2002/nmap/4.jpg?raw=true)

