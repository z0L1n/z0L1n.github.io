---
layout:     post                    # 使用的布局（不需要改）
title:      复习日记-web基础-SQL               # 标题 
subtitle:   整理一下自己的学习文档
date:       2020-03-22              # 时间
author:     z0L1n                      # 作者
header-img: img/post-bg-2015.jpg    #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               #标签
    - web漏洞
---

## 0x00 SQL注入概念

> SQL注入是指web应用对用户输入数据的合法性没有进行判断或者过滤不严，导致攻击者可以在事先定义好的查询语句
的结尾上添加额外的SQL语句，实现非法操作，执行非授权的任意查询，获得相应的信息。

- 一般来说，SQL注入是将web页面的输入参数修改拼接成SQL语句，传递给服务器，进而传给数据库服务器执行数据库命令。
SQL注入语句一般直接参与在sql编译的时候，所以才会导致攻击成功，会导致数据库信息的泄露以及提权，危害性大。

## 0x01 常规sql注入：
- 1、寻找注入点：先测试单双引号过滤情况，然后通过and 1=1、and1=2等方法测试，现在一般来说需要这些语句会被waf直接拦截，可以尝试编码绕过，
或者添加过多的括号。
- 2、判断后台数据库类型：如果输入参数导致数据库报错，根据报错信息容易识别数据库类型，一般来说有以下几种常见搭配：`ASP和.NET：Microsoft SQL Server`
`PHP：MySQL、PostgreSQL` `Java：Oracle、MySQL`
- 3、注入类型：
> **①联合注入（union注入）：在闭合查询参数后，直接使用union连接使用的sql语句，完成联合查询，查询数据等等内容，此类sql注入主要是利用
参数拼接SQL语句且对参数安全性没有检验。简单的例子为：`1' union select 1,2,3#`**

> **②布尔注入（boolean注入）：该注入主要利用页面返回结果来判断我们的哪些SQL判断条件是成立的。通常需要爆破数据库的库名，表名，字段名，需要大量的请求以及响应。在利用布尔注入的过程中，一般我会利用自己的盲注脚本来进行爆破，观测返回页面中的关键词，然后纳入脚本判断中负责对正确页面的辨识，然后收集信息，个人盲注脚本思路为，先爆破数据库名长度，爆破数据库然后通过二分法来快速找到字符ascii码然后记录信息。**

> **③报错注入：程序将报错信息直接显示在了返回的页面上，这个时候我们就能利用报错注入攻击来获取所需要的数据库可信息：个人常用的三个报错注入语句为**

>>**通过floor报错注入（双查询语句）：`and select 1 from (select count(*),concat(version(),floor(rand(0)*2))x from information_schema.tables group by x)a);`**

>>**通过extractvalue报错注入：`and extractvalue(1, concat(0x5c, (select table_name from information_schema.tables limit 1)));`**

>>**通过updatexml报错注入： `and 1=(updatexml(1,concat(0x3a,(select user())),1))`**

> **④时间注入：这种情况网页的访问情况和布尔注入相似，利用sleep函数orbenchmark函数使mysql执行时间延长，手工的话一般很少用，个人在sqlmap上才会跑这种注入经常与条件判断语句结合，`if(exp1,exp2,exp3)`如果exp1成立，返回exp2，否则返回exp3.然后通过查看响应时间来完成条件判断。**

>>**举个例子：`and if(hex(mid(user(),1,1))=1,sleep(3),1)`**

> **⑤堆叠查询注入：堆叠查询可以执行多条语句，每条语句用；分隔开。对于数字型sql注入，可以直接使用，一般在第二条SQL语句中构造攻击语句进行注入攻击,堆叠查询一般来说直接拼接执行语句即可。**
>> **堆叠注入时，可以利用预编译语句来实现sql注入如果需要用到的话：**

`-1';`

`set @sql = concat('se','lect * from table-name;');`

`prepate inj from @sql;`

`execute inj;`

> **⑥宽字节注入：假如当我们测试过滤词以及符号时，提示错误\',这个时候说明单引号被转义字符转义了，无法逃逸单引号包围，理论上来说是没有注入点，但是如果涉及到数据库编码为GBK编码（2字节存储），那么可以实现宽字节注入利用`%df\`会转码成一个中文字符来绕过该转义，宽字节注入主要通过编码规则来进行。**

> **⑦二次注入攻击：二次注入流程就是，首先构造sql注入语句存储进数据库，生成二次注入前提，然后跳转到第二页面的时候通过获取该语句（类似用户名为sql注入拼接好的语句，第二个页面会通过该username获取关于username的信息，使sql注入语句添加到where id='xxxxxx'中编译执行），这个流程可以为二次注入。**

> **⑧coolie注入攻击：如果url中没有参数，只有cookie，针对cookie进行注入攻击，我们的sql拼接语句构造都是在cookie中，所以称为cookie攻击。**

0x02 常规知识点：
- 1、一些常用函数：database()/version()/user()
- 2、注释符：#、--、/**/、/*! code */
- 3、当空格被过滤时可以使用^以及（）来替换
- 4、mysql中的information_schema表
- 5、测试网站sql注入时，一定要切记加上 limit m,n

